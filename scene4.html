<meta charset="utf-8">
<script src="https://d3js.org/d3.v4.js"></script>
<html>
    <head>
        <style>
            h1 {
                text-align: center;
            }
            #scene1,#scene2,#scene3 {
              /* margin-left: 300px; */
              display:flex;
              justify-content: center;
              align-items: center;
            }
            /* .selected {
              opacity: 1 !important;
              stroke: black;
              stroke-width: 1px;
              fill:'#00ffff'
            } */
        </style>
        <title>Narraive Visualization scene 2</title>
    </head>
    <body>

        <div><h1>scene 4 ranking of highway mpg within each power</h1></div>
        <p>please select one fuel: </p>
          <input type="radio"  name="fuel" value="Gasoline" checked="True">
          <label >Gasoline</label><br>
          <input type="radio"  name="fuel" value="Electricity">
          <label >Electricity</label><br>
          <input type="radio"  name="fuel" value="Diesel">
          <label >Diesel</label><br>
        <p>please select one number of cylinder: </p>
          <input type="radio"  name="cylinder" value="2">
          <label >2</label><br>
          <input type="radio"  name="cylinder" value="4">
          <label >4</label><br>
          <input type="radio"  name="cylinder" value="6" checked="True">
          <label >6</label><br>
          <input type="radio"  name="cylinder" value="8">
          <label >8</label><br>
        <!-- <label>enter fuel: </label><input id="fuel"><br><br>
        <label>enter number of cylinder: </label><input id="number_cylinder"><br><br> -->
        <button onclick="update_scene2(get_selected('fuel'),get_selected('cylinder'))">find</button>
        <div id="scene2"></div>


    </body>
</html>
<script>





// //scene2
// var margin = {top: 30, right: 30, bottom: 70, left: 60},
//     width = 2000 - margin.left - margin.right,
//     height = 600 - margin.top - margin.bottom;

// // append the svg object to the body of the page
// var svg = d3.select("#scene2")
//   .append("svg")
//     .attr("width", width + margin.left + margin.right)
//     .attr("height", height + margin.top + margin.bottom)
//   .append("g")
//     .attr("transform",
//           "translate(" + margin.left + "," + margin.top + ")");



// A function that create / update the plot for a given variable:
function update_scene2(fuel,number_cylinder) {
  d3.select('#scene2').html('')
  // console.log(fuel + number_cylinder)
  //scene2
  var margin = {top: 30, right: 30, bottom: 70, left: 60},
      width = 1600 - margin.left - margin.right,
      height = 600 - margin.top - margin.bottom;

  // append the svg object to the body of the page
  var svg = d3.select("#scene2")
    .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");
  d3.csv("https://flunky.github.io/cars2017.csv", function(data) {
    var filtered_data=data.filter(function(d){return (d.Fuel==fuel && d.EngineCylinders==number_cylinder)})
    // console.log(filtered_data)
    if (filtered_data.length==0){
      alert('can not find data that match filter. please choose another pair')
      return
    }
    filtered_data.sort(function(b,a){return a.AverageHighwayMPG-b.AverageHighwayMPG;});
    // X axis
    var x = d3.scaleBand()
      .range([ 0, width ])
      .domain(filtered_data.map(function(d) { return d.Make; }))
      .padding(0.2);
    svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));
    var candidate=filtered_data.map(object=>object.AverageHighwayMPG)
    var max_value=Math.max(...candidate)
    // Add Y axis
    var y = d3.scaleLinear()
      .domain([0, max_value])
      .range([ height, 0]);
    svg.append("g")
      .attr("class", "myYaxis")
      .call(d3.axisLeft(y));
  var tooltip = d3.select("#scene2")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "1px")
    .style("border-radius", "5px")
    .style("padding", "2px")
    .style('position','absolute')
  var mouseover = function(d) {
    tooltip
      .style("opacity", 1)
  }

  var mousemove = function(d) {
    tooltip
      .html("average city mpg: " + d.AverageHighwayMPG + ' make: ' + d.Make)
      .style("left", (d3.mouse(this)[0])  + "px") // It is important to put the +90: other wise the tooltip is exactly where the point is an it creates a weird effect
      .style("top",  (d3.mouse(this)[1]) + 200 + "px");
    // console.log(d3.mouse(this));
  }

  // A function that change this tooltip when the leaves a point: just need to set opacity to 0 again
  var mouseleave = function(d) {
    tooltip
      .transition()
      .duration(200)
      .style("opacity", 0)
  }
  var u = svg.selectAll("rect")
    .data(filtered_data)
  
  u
    .enter()
    .append("rect")
    .merge(u)
    .transition()
    .duration(1000)
      .attr("x", function(d) { return x(d.Make); })
      .attr("y", function(d) { return y(d.AverageHighwayMPG); })
      .attr("width", x.bandwidth())
      .attr("height", function(d) { return height - y(d.AverageHighwayMPG); })
      .attr("fill", "#69b3a2")
  d3.selectAll('rect')
    .on('mouseover',mouseover)
    .on('mousemove',mousemove)
    .on('mouseleave',mouseleave)
  })

}
update_scene2('Gasoline','6')

function get_selected(name){
  var elements = document.getElementsByName(name)
  for (i=0;i<elements.length;i++){
    if (elements[i].checked){
      console.log(elements[i].value)
      return elements[i].value
    }
  }
  return null
}


</script>